<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="theHUB">
<title>EDW: R-SQL Setup • theHUB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EDW: R-SQL Setup">
<meta property="og:description" content="theHUB">
<meta property="og:image" content="https://emilioxavier.github.io/theHUB/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-143011948-3"></script><script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date());
gtag('config', 'UA-143011948-3'); </script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">theHUB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-pagroup">PAGroup</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-pagroup">
    <a class="dropdown-item" href="../articles/web_only/PAG_About.html">About</a>
    <a class="dropdown-item" href="../articles/web_only/PAG_GroupMeetings.html">Group Meetings</a>
    <a class="dropdown-item" href="../articles/web_only/PAG_GuidelinesAndPolicies.html">Guidelines &amp; Policies</a>
    <a class="dropdown-item" href="../articles/web_only/PAG_ProfessionalDevelopment.html">Professional Development</a>
    <a class="dropdown-item" href="../articles/web_only/PAG_HowILikeToBeMentored.html">How I Like to be Mentored</a>
    <a class="dropdown-item" href="../articles/web_only/PAG_Onboarding.html">Onboarding</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Advanced Candidate Evaluation (ACE)</h6>
    <a class="dropdown-item" href="../articles/AdvancedCandidateEvaluation.html">ACE - Overview</a>
    <a class="dropdown-item" href="../articles/AdvancedCandidateEvaluation_questions.html">ACE - Base Questions</a>
    <a class="dropdown-item" href="../articles/AdvancedCandidateEvaluation_setup.html">ACE - Setup</a>
    <h6 class="dropdown-header" data-toc-skip>GeoCoding</h6>
    <a class="dropdown-item" href="../articles/GeoCoding_DownloadShapeFiles.html">Downloading Shape Files</a>
    <h6 class="dropdown-header" data-toc-skip>MSUEDW</h6>
    <a class="dropdown-item" href="../articles/EDW_dBeaverSetup.html">dBeaver Setup</a>
    <a class="dropdown-item" href="../articles/EDW_R-SQLsetup.html">R-SQL Setup</a>
    <h6 class="dropdown-header" data-toc-skip>SQL Snippet Library for the MSUEDW (Coming soon!)</h6>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/emilioxavier/theHUB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/exesposito" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>EDW: R-SQL Setup</h1>
            
            <h4 data-toc-skip class="date">Updated 11/Jan/2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/emilioxavier/theHUB/blob/HEAD/vignettes/EDW_R-SQLsetup.Rmd" class="external-link"><code>vignettes/EDW_R-SQLsetup.Rmd</code></a></small>
      <div class="d-none name"><code>EDW_R-SQLsetup.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="ferpa-disclaimer-statement">FERPA Disclaimer Statement<a class="anchor" aria-label="anchor" href="#ferpa-disclaimer-statement"></a>
</h3>
<blockquote>
<p><strong>IMPORTANT NOTE</strong>: You are solely responsible for the
maintenance of the confidentiality of this information as established in
the Family Educational Rights and Privacy Act (FERPA) and Michigan State
University Guidelines Governing Privacy and Release of Student
Records.</p>
</blockquote>
<hr>
</div>
<div class="section level2">
<h2 id="accessing-msuedw-data-using-r">Accessing MSUEDW Data using <code>R</code><a class="anchor" aria-label="anchor" href="#accessing-msuedw-data-using-r"></a>
</h2>
<p>While the Oracle SQL Developer is a nice application for exploring
the available data, and <a href="https://dbeaver.io" class="external-link">dBeaver
Community</a> is even better, why use one application to access and
download and another to analyze the data? The following <code>R</code>
code examples and snippets provide a collection of common MSUEDW data
pulls and merges done entirely in <code>R</code>. We believe off-loading
filters and merges to a locol machine reduces the load on the SQL
server. <em>NB: We commonly – and encourage – the use dBeaver of
<strong>explore</strong> the various Views/Tables within the EDW to
explore the contained data and determine the fields of interest.
Additionally, we use dBeaver to determine fields to restrict data
pulls.</em></p>
<p>The following documentation is segmented into sections based on
specific actions.</p>
<!-- Click here for an `R` file with the settings and an example snippet. -->
</div>
<div class="section level2">
<h2 id="download-and-install-the-oracle-database-jdbc-driver-and-companion-jars-downloads">Download and Install the Oracle Database JDBC driver and Companion
Jars Downloads<a class="anchor" aria-label="anchor" href="#download-and-install-the-oracle-database-jdbc-driver-and-companion-jars-downloads"></a>
</h2>
<p>Visit the <a href="https://www.oracle.com/database/technologies/appdev/jdbc-downloads.html" class="external-link">Oracle
Database JDBC driver and Companion Jars Downloads</a> page and download
the <a href="https://download.oracle.com/otn-pub/otn_software/jdbc/218/ojdbc11-full.tar.gz" class="external-link">Zipped
JDBC driver (ojdbc11.jar) and Companion Jars</a> file.</p>
<p>The following instructions are for installation on macOS (version 11
or newer). Similar steps should work on Linux and Windows.</p>
<div class="section level3">
<h3 id="command-line-install">Command Line Install<a class="anchor" aria-label="anchor" href="#command-line-install"></a>
</h3>
<p>Within your <code>home</code> directory (aka folder) create a
<code>software</code> directory. Move the
<code>ojdbc11-full.tar.gz</code> file into the <code>software</code> and
unzip the file. The easiest way to accomplish this is via the macOS
Terminal. When downloading the <code>ojdbc11-full.tar.gz</code> file you
were likely given the option where to save it. Please save it to the
<code>Downloads</code> directory.</p>
<pre class="shell"><code>emilio@iMac ~ % mkdir -p software
emilio@iMac ~ % cd software
emilio@iMac software % tar zxvf ~/Downloads/ojdbc11-full.tar.gz
emilio@iMac software % cd ojdbc11-full
emilio@iMac ojdbc11-full % ls
Javadoc-Readmes    ojdbc.policy      ojdbc11dms_g.jar   osdt_cert.jar    ucp11.jar
LICENSE.txt        ojdbc11.jar       ons.jar            osdt_core.jar    xdb.jar
README.txt         ojdbc11_g.jar     oraclepki.jar      rsi.jar          xmlparserv2.jar
dms.jar            ojdbc11dms.jar    orai18n.jar        simplefan.jar    xmlparserv2_sans_jaxp_services.jar</code></pre>
</div>
<div class="section level3">
<h3 id="install-via-the-file-viewer">Install Via the File Viewer<a class="anchor" aria-label="anchor" href="#install-via-the-file-viewer"></a>
</h3>
<p>Open a macOS finder window and ensure you are in your
<code>home</code> directory.</p>
<ul>
<li>Create a folder called “software”</li>
<li>Copy (or move) the <code>ojdbc11-full.tar.gz</code> file to the
<code>software</code> folder</li>
<li>Double click the <code>ojdbc11-full.tar.gz</code> file to unzip the
file</li>
</ul>
</div>
<div class="section level3">
<h3 id="location-of-the-ojdbc-jar-file">Location of the OJDBC Jar File<a class="anchor" aria-label="anchor" href="#location-of-the-ojdbc-jar-file"></a>
</h3>
<p>The location (aka complete path) of the <code>ojdbc11.jar</code> file
is needed to set the <code>classPath</code> variable for the
<code>RJDBC::JDBC()</code> function within the <code>R</code> script
below. For my installation, the <code>classPath</code> is
<code>/Users/emilio/software/ojdbc11-full/ojdbc11.jar</code></p>
</div>
</div>
<div class="section level2">
<h2 id="install-java--and-sql-specific-r-packages">Install Java- and SQL-specific <code>R</code> Packages<a class="anchor" aria-label="anchor" href="#install-java--and-sql-specific-r-packages"></a>
</h2>
<p>The following packages are needed to access the MSUEDW SQL server.
They only need to be installed once, but if you upgrade your
<code>R</code> instance, you might need to reinstall these packages. The
<a href="https://cran.r-project.org/package=rJava" class="external-link"><code>DBI</code></a>,
<a href="https://cran.r-project.org/package=DBI" class="external-link"><code>rJava</code></a>,
and <a href="https://cran.r-project.org/package=RJDBC" class="external-link"><code>RJDBC</code></a>
packages allow <code>R</code> to connect to the Oracle database, while
<a href="https://cran.r-project.org/package=keyring" class="external-link"><code>keyring</code></a>
safely stores your password. The <a href="https://www.tidyverse.org/" class="external-link"><code>tidyverse</code></a> is a
collection of <code>R</code> packages designed to streamline and make
data analysis easier.</p>
<p>Open <strong>RStudio</strong> and enter the following command in the
<strong>Console</strong>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"DBI"</span>, <span class="st">"rJava"</span>, <span class="st">"RJDBC"</span>, <span class="st">"keyring"</span>, <span class="st">"tidyverse"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="save-your-password-in-your-secure-keyring">Save Your Password in Your Secure Keyring<a class="anchor" aria-label="anchor" href="#save-your-password-in-your-secure-keyring"></a>
</h2>
<p>The <a href="https://r-lib.github.io/keyring/reference/key_get.html" class="external-link"><code>keyring::key_set()</code></a>
function prompts the user to enter their password. The ability to have
the <code>R</code> session interact with <a href="https://r-lib.github.io/keyring/reference/backend_macos.html" class="external-link">macOS
Keychain keyring</a>, <a href="https://r-lib.github.io/keyring/reference/backend_wincred.html" class="external-link">Windows
Credential Store keyring</a> or <a href="https://r-lib.github.io/keyring/reference/backend_secret_service.html" class="external-link">Linux
Secret Service keyring</a> to obtain your password from a secure
keyring. For additional information about keyrings on specific operating
systems, please see the following:</p>
<ul>
<li>Apple article on <a href="https://support.apple.com/guide/keychain-access/what-is-keychain-access-kyca1083/mac" class="external-link">What
is Keychain Access on Mac?</a>
</li>
<li>Microsoft article on <a href="https://support.microsoft.com/en-us/windows/accessing-credential-manager-1b5c916a-6a16-889f-8581-fc16e8165ac0" class="external-link">Accessing
Credential Manager</a>
</li>
<li>Linux manual page entry on <a href="https://man7.org/linux/man-pages/man7/keyrings.7.html" class="external-link">keyrings</a>
</li>
</ul>
<p>Open <strong>RStudio</strong> and enter the following command in the
<strong>Console</strong>. The following function stores your password in
secure keyring of your operating system. Securely storing you password
allows you to automate data pulls and script actions without including a
password in the script.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_set</span><span class="op">(</span>service<span class="op">=</span><span class="st">"MSUEDW"</span>, username<span class="op">=</span><span class="st">"USERNAME"</span><span class="op">)</span></span></code></pre></div>
<p>After submitting the command, a password submission box opens. Enter
your MSUEDW password and the “OK” button.</p>
<div class="figure">
<img src="images_EDW/EDW_RStudio-password-prompt.png" style="width:40.0%" alt=""><p class="caption">RStudio Password Prompt</p>
</div>
<p>The <code>keyring::key_set()</code> function creates a MSUEDW entry
within the keyring, in this case for macOS.</p>
<div class="figure">
<img src="images_EDW/EDW_Keychain-MSUEDW-entry.png" style="width:100.0%" alt=""><p class="caption">macOS Keychain Access</p>
</div>
<p>Exploring the entry, you can see the service name
(<code>MSUEDW</code>), account name (<code>USERNAME</code>), and the
password (<code>1235567890</code>). The Access Control enables the need
to notice require the keychain (or keyring) password to access the
password for any <code>R</code> session.</p>
<div class="figure">
<img src="images_EDW/EDW_Keychain-MSUEDW-Attributes-AcessControl.png" style="width:100.0%" alt=""><p class="caption">MSUEDW Attributes and Access Control within the macOS
Keychain</p>
</div>
<p>You can also retrieve the password using the
<code>keyring::key_get()</code> command in the <strong>RStudio
Console</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>keyring<span class="sc">::</span><span class="fu">key_get</span>(<span class="st">"MSUEDW"</span>,<span class="st">"USERNAME"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"12345678910"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-r-script">The <code>R</code> Script<a class="anchor" aria-label="anchor" href="#the-r-script"></a>
</h2>
<p>The following describes the components of the <code>R</code> script
used to interact with and download data from the MSUEDW. The script is
segmented into components to facilitate easier explanations.</p>
<div class="section level3">
<h3 id="set-java-parameters">Set Java Parameters<a class="anchor" aria-label="anchor" href="#set-java-parameters"></a>
</h3>
<p>The first line of the <code>R</code> file instructs Java to clean up
after itself and use a maximum amount of user specified memory (aka
RAM).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>java.parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"-XX:+UseConcMarkSweepGC"</span>, <span class="st">"-Xmx8192m"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/cms.html" class="external-link">Concurrent
Mark Sweep (CMS) Collector</a> for “shorter garbage collection
pauses.”</li>
<li><a href="https://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/geninfo/diagnos/memman.html" class="external-link">Set
the <strong>maximum</strong> memory heap size</a></li>
</ul>
<p>Typically, we set the only the maximum memory heap size and set it at
a value of ~ 8 Gb; <code>-Xmx8192m</code> or <code>-Xmx8g</code>. If
your computer has more memory, feel free to increase the value. See the
<a href="https://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/jrdocs/refman/optionX.html#wp999528" class="external-link">-Xmx
documentation</a> for additional information. <em>NB: From the
<code>-Xmx</code> documentation, “<code>-Xmx</code> does not limit the
total amount of memory that the JVM can use.”</em></p>
</div>
<div class="section level3">
<h3 id="load-required-r-packages">Load Required <code>R</code> Packages<a class="anchor" aria-label="anchor" href="#load-required-r-packages"></a>
</h3>
<p>Next, we load the packages needed to query the SQL server and filter
and merge the results.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/rJava/" class="external-link">rJava</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/RJDBC/" class="external-link">RJDBC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-lib.github.io/keyring/index.html" class="external-link">keyring</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-connection-driver">Create Connection Driver<a class="anchor" aria-label="anchor" href="#create-connection-driver"></a>
</h3>
<p>Create the JDBC connection drive using the <code>classPath</code>
determined above.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jdbcDriver</span> <span class="op">&lt;-</span> <span class="fu">RJDBC</span><span class="fu">::</span><span class="fu">JDBC</span><span class="op">(</span>driverClass<span class="op">=</span><span class="st">"oracle.jdbc.OracleDriver"</span>, </span>
<span>                          classPath<span class="op">=</span><span class="st">"/Users/emilio/software/ojdbc11-full/ojdbc11.jar"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-connection-to-msuedw">Create Connection to MSUEDW<a class="anchor" aria-label="anchor" href="#create-connection-to-msuedw"></a>
</h3>
<p>Create connection details for MSUEDW (details are found in the
<code>tnsnames.ora</code> file). Remember to replace
<code>"USERNAME"</code> with your username in
<em><strong>both</strong></em> places. Also, the general connection
format is included along with MSUEDW specific function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Connection format is:</span></span>
<span><span class="co"># DBI::dbConnect(jdbcDriver, </span></span>
<span><span class="co">#                "jdbc:oracle:thin:@//database.hostname.com:port/service_name_or_sid", </span></span>
<span><span class="co">#                "username", "password")</span></span>
<span></span>
<span><span class="va">MSUEDW.jdbc</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="va">jdbcDriver</span>, </span>
<span>                              <span class="st">"jdbc:oracle:thin:@//ebsprd390d.ais.msu.edu:1521/MSUEDW.EBSP.MSU.EDU"</span>,</span>
<span>                              <span class="st">"USERNAME"</span>, </span>
<span>                              <span class="fu">keyring</span><span class="fu">::</span><span class="fu">key_get</span><span class="op">(</span><span class="st">"MSUEDW"</span>,<span class="st">"USERNAME"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="construct-sql-query">Construct SQL Query<a class="anchor" aria-label="anchor" href="#construct-sql-query"></a>
</h3>
<p>Construct the SQL query to be passed to the SQL server. The query can
be basic or complex. This example is very basic and selects the first 10
lines from the <code>siscs.c_class_tbl_v</code> table (view). We gave
the variable a very general name (<code>sql.query</code>), but using a
more specific name is advisable when making multiple data pulls. For
example, a possible name for this query is <code>sql.ClassTable</code>
where the <code>sql</code> indicates the variable contains an SQL query
and <code>ClassTable</code> indicate the query is to pull class table
data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sql.query</span> <span class="op">&lt;-</span> <span class="st">"select *</span></span>
<span><span class="st"> from siscs.c_class_tbl_v</span></span>
<span><span class="st"> where rownum &lt;= 10"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="send-query-and-fetch-results">Send Query and Fetch Results<a class="anchor" aria-label="anchor" href="#send-query-and-fetch-results"></a>
</h3>
<p>These two command sends the SQL query to the indicated SQL server
(<code><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html" class="external-link">dbSendQuery()</a></code>) and then fetches (aka downloads) the data
(<code><a href="https://dbi.r-dbi.org/reference/dbFetch.html" class="external-link">dbFetch()</a></code>). The <code>query.data</code> variable contains
the data resulting from your SQL query. Potentially better variable
names include <code>ClassTable.results</code> and
<code>ClassTable.data</code>, respectively.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query.results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbSendQuery.html" class="external-link">dbSendQuery</a></span><span class="op">(</span><span class="va">MSUEDW.jdbc</span>, <span class="va">sql.query</span><span class="op">)</span></span>
<span><span class="va">query.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dbi.r-dbi.org/reference/dbFetch.html" class="external-link">dbFetch</a></span><span class="op">(</span><span class="va">query.results</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="save-the-data">Save the Data<a class="anchor" aria-label="anchor" href="#save-the-data"></a>
</h3>
<p>Only save the data while excluding the <code>query.results</code>. It
is prudent to retain the <code>sql.query</code> because it is possible
that when reopening the data file, you do not have access to the
original <code>R</code> script used to pull the data. This is common if
you pull the data for a colleague or <em>vice versa</em>. Additionally,
saving the <code>query.results</code> will cause errors when reading in
the data file if the <code>DBI</code> package is not loaded.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sql.query"</span>, <span class="st">"query.data"</span><span class="op">)</span>,</span>
<span>     file<span class="op">=</span><span class="st">"SQL_data.RData"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="close-the-jdbc-connection">Close the JDBC Connection<a class="anchor" aria-label="anchor" href="#close-the-jdbc-connection"></a>
</h3>
<p>Remember to clean up when done by closing the database
connection.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">MSUEDW.jdbc</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emilio Xavier Esposito.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
